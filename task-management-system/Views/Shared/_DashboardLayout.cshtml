<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Yeloe Dashboard</title>
    <link rel="icon" href="~/images/icon/yeloe-icon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/lib/fontawesome/css/all.css" />
    <link rel="stylesheet" href="~/css/font.css" asp-append-version="true" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/dashboard-css/sidebar.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/loader-css/loader.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/dark-mode.css" asp-append-version="true" />

    <!-- Dark Mode Initialization (must load early) -->
    <script src="~/js/dark-mode-init.js" asp-append-version="true"></script>

</head>
<body class="dashboard-body">
    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <img src="~/images/logo/yeloe-brand-text.png" alt="Yeloe Logo" class="logo-icon" />
                </div>
            </div>

            <nav class="sidebar-nav">
                <!-- MENU Section -->
                <div class="nav-section">
                    <div class="nav-section-label">MENU</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a asp-controller="Dashboard" asp-action="Index" class="nav-link">
                                <i class="fas fa-chart-line"></i>
                                <span class="nav-text">Dashboard</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a asp-controller="Planner" asp-action="Index" class="nav-link">
                                <i class="fas fa-calendar"></i>
                                <span class="nav-text">Planner</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a asp-controller="Task" asp-action="Index" class="nav-link">
                                <i class="fas fa-tasks"></i>
                                <span class="nav-text">Tasks</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a asp-controller="Projects" asp-action="Index" class="nav-link">
                                <i class="fas fa-folder-open"></i>
                                <span class="nav-text">Projects</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- OTHER Section -->
                <div class="nav-section">
                    <div class="nav-section-label">OTHER</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a asp-controller="Account" asp-action="Index" class="nav-link">
                                <i class="fas fa-user"></i>
                                <span class="nav-text">Account</span>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a asp-controller="Account" asp-action="Settings" class="nav-link">
                                <i class="fas fa-gear"></i>
                                <span class="nav-text">Settings</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <!-- Search Bar -->
                    <div class="search-container">
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="globalSearch" placeholder="Search tasks, projects, and more...">
                            <button class="search-clear" id="searchClear" style="display: none;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="search-results" id="searchResults"></div>
                    </div>
                </div>

                <div class="header-right">
                    <div class="header-actions">
                        
                        <!-- Quick Actions Dropdown -->
                        <div class="quick-actions-menu">
                            <button class="header-btn quick-actions-btn" id="quickActionsBtn" title="Quick Actions">
                                <i class="fas fa-plus"></i>
                            </button>
                            <div class="dropdown-menu quick-actions-dropdown" id="quickActionsDropdown">
                                <div class="quick-actions-header">
                                    <h6 class="quick-actions-title">Quick Actions</h6>
                                </div>
                                <div class="quick-actions-body">
                                    <button class="quick-action-item" onclick="createNewTask()">
                                        <i class="fas fa-tasks"></i>
                                        <span>New Task</span>
                                    </button>
                                    <button class="quick-action-item" onclick="createNewProject()">
                                        <i class="fas fa-folder-plus"></i>
                                        <span>New Project</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- User Menu with Dropdown -->
                        <div class="user-menu">
                            <button class="user-menu-btn" id="userMenuBtn">
                                <div class="user-avatar-small">
                                    <i class="fas fa-user"></i>
                                </div>
                                <span class="user-name-small">
                                @(ViewBag.UserName ?? ViewBag.UserEmail ?? "User")
                                </span>
                                <i class="fas fa-chevron-down"></i>
                            </button>

                            <div class="dropdown-menu user-dropdown" id="userDropdown">
                                <!-- Updated logout button in dropdown with modal trigger -->
                                <button class="dropdown-item" id="logoutBtnDropdown">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Sign Out
                                </button>
                            </div>
                        </div>

                        <!-- Dynamic Notification Button with Dropdown -->
                        <div class="notification-menu">
                            <button class="header-btn notification-btn" id="notificationBtn">
                                <i class="fas fa-bell"></i>
                                <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                            </button>

                            <div class="dropdown-menu notification-dropdown" id="notificationDropdown">
                                <div class="notification-header">
                                    <h6 class="notification-title">Notifications</h6>
                                </div>
                                
                                <div class="notification-body" id="notificationsList">
                                    <div class="notification-loading">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        <p>Loading notifications...</p>
                                    </div>
                                </div>

                                <div class="notification-footer">
                                    <button class="btn btn-outline" id="markAllReadBtn">
                                        <i class="fas fa-check-double"></i>
                                        Mark all read
                                    </button>
                                    <button class="btn btn-primary" id="viewAllNotificationsBtn">
                                        <i class="fas fa-bell"></i>
                                        View all
                                    </button>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content">
                @RenderBody()
            </div>
        </main>
    </div>

    <!-- Hidden logout form for functionality -->
    <form asp-controller="Auth" asp-action="Logout" method="post" id="logoutForm" style="display: none;">
    </form>

    <!-- Simple Logout Confirmation Modal -->
        <div class="modal fade logout-modal" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="logout-modal-icon">
                            <i class="fas fa-sign-out-alt"></i>
                        </div>
                        <h5 class="logout-modal-title">Sign Out</h5>
                        <p class="logout-modal-text">Are you sure you want to sign out?</p>
                        
                        <div class="logout-modal-actions">
                            <button type="button" class="btn logout-btn-cancel" data-bs-dismiss="modal">
                                Cancel
                            </button>
                            <button type="button" class="btn logout-btn-confirm" id="confirmLogoutBtn">
                                <span class="btn-text">Sign Out</span>
                                <span class="btn-loading" style="display: none;">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <!-- Scripts -->
    <script src="~/js/loader-js/loader.js" asp-append-version="true"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/dashboard-js/dashboard.js" asp-append-version="true"></script>
    <script src="~/js/dashboard-js/search.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>